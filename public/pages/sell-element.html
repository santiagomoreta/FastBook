


<polymer-element name="sell-element">
    <template>
        <style>
        :host {
            position: absolute;
            width: 100%;
            height: 100%;
            box-sizing: border-box;
        }
        section#main {
          
            background: rgba(8,46,64, 0.6);
            border-radius: 10px;
           // background-image: url('../images/oscuro.jpg');
            background-size: 100% 100%;
            background-repeat: no-repeat;
            border: 3px solid dimgray;
            margin: 20px;
            height: 909px;
            color:white;
        }
        paper-input /deep/ input{
              
             color:white; 
        }
        input{
            color:white;
        }
        boton-continuar{
             border-radius: 7px;
            border:1px solid black;
        }

        h1 {
            font-size: 20px;
        }

        h1, label {
        color: white;
        font-family: Courier;
        font-weight: bold;
       
        }

        label{

            display: inline-block;
            width:100px;
        

        }
             #butt {
            background-image: url('../images/log.jpg');
            background-size: 100% 100%;
            background-repeat: no-repeat;
            color: white;
            font-weight: bold;
            margin-top: 20px;
        }
   
        paper-dropdown-menu{
      background-color: transparent;
        }
        textarea{
            border-radius: 7px;
            border:1px solid black;
            margin-bottom: 1%;
            width: 400px;
            resize: none;
        }
        #contenido-izq{
            position:relative;
            width:40%;
            margin-left: 20px;
            float:left;
            
        }
        #right{
            position:relative;
            float:right;
            width:50%;
            margin-right: 20px;
            margin-top: 8.5%;
        }
        #foo{
            position:relative;
            float:right;
            width: 100%;
            text-align: center;
            
        }
        select{
          height: 50px;
          width: 180px;
          margin-bottom: 10px;
        }
        
        #divisbn{
          width: 100%;
          height: 260px;
         padding: 1%;
          margin-top: 1%;
          margin-left: 1%;
              background-image: url('../images/log.jpg');
            background-size: 100% 100%;
            background-repeat: no-repeat;
            color: white;
               border-radius: 7px;
           
        }
        p{
          color:white;
        }
    
         @media (max-width: 600px) {
         
             textarea{
              width: 315px;
             }
             
           #contenido-izq{
            position:relative;
            width:100%;
            margin-left: 0px;
        
            
        }
        #right{
            position:relative;
    
            width:1000%;
            margin-right: 0%;
            margin-top: 0%;
        } 
           select{
          height: 50px;
          width: 90px;
          margin-left: 80%;
        }
         }
         
        </style>
        <section id="main" >
          
          <div  id="contenido-izq">
            
            

              <h1>Put a book for sale</h1>
            

         
            
             <paper-input-decorator label="Title" floatingLabel error="Title is required!">
              <input is="core-input" id="titulo" required/>
             </paper-input-decorator>
             
              <paper-input-decorator label="Author" floatingLabel error="Author is required!">
              <input is="core-input" id="autor" required/>
             </paper-input-decorator> 

             <paper-input-decorator label="Publisher" floatingLabel error="Publisher is required!">
              <input is="core-input" id="editorial"/>
             </paper-input-decorator>
              
            <paper-input-decorator label="Price" floatingLabel error="Price is required!" id="decoprecio">
              <input is="core-input" id="precio"  required/>
             </paper-input-decorator>
            
              
             <paper-input-decorator label="ISBN" floatingLabel error="ISBN is required!" id="decoisbn">
              <input is="core-input" id="isbn" required/>
             </paper-input-decorator>
              
          
             <!-- <paper-button id="butt" on-tap="{{validateIsbn}}">Comprobar ISBN</paper-button>-->
             <paper-button id="butt" on-tap="{{validateIsbn}}">
                Validate ISBN</paper-button>
             <div id="divisbn" hidden>
               
               <core-input id="tisbn" disabled></core-input>
               <core-input id="ttitulo" disabled></core-input>
               <core-input id="tautor" disabled></core-input><br>
                <img id="timg"></img>
               
             </div>
              
           

            
          </div>
          <div id="right">
            <paper-input-decorator label="Category" floatingLabel error="Category is required!" id="cate">
              <select id="cat" >
               
                   
                  <option value="0"> Select Category</option>          
                <option >primaria </option>
                <option> secundaria</option>
                <option > bachillerato</option>
                <option> universidad</option>
                <option> formacion profesional</option>
                <option > oposiciones</option>
                <option  >lectura</option>
                                     
             
                
             
               </select> 
                 </paper-input-decorator>   
            
            <br>
            <paper-input-decorator label="Province" floatingLabel error="province is required!"id="provi" >
            <select id="pro">
                 <option value="0"> Select Province</option>      
              <option> A Coruña</option>
              <option> Alicante</option>
                <option>Albacete</option>
                <option>Almería</option>
                <option>Araba</option>
                <option >Asturias</option>
                <option>Ávila</option>
                <option >Badajoz</option>
                <option >Balears</option>
                <option>Barcelona</option>
                <option >Bizkaia</option>
                <option >Burgos</option>
                <option >Cáceres</option>
                <option >Cádiz</option>
                <option >Cantabria</option>
                <option >Castelló</option>
                <option >Ceuta</option>
                <option >Ciudad Real</option>
                <option >Córdoba</option>
                <option>Cuenca</option>
                <option >Girona</option>
                <option>Granada</option>
                <option >Guadalajara</option>
                <option >Guipuzkoa</option>
                <option >Huelva</option>
                <option>Huesca</option>
                <option >Jaén</option>
                <option>La Rioja</option>
                <option >Las Palmas</option>
                <option >León</option>
                <option >Lleida</option>
                <option >Lugo</option>
                <option>Madrid</option>
                <option >Málaga</option>
                <option >Melilla</option>
                <option>Murcia</option>
                <option >Navarra</option>
                <option >Ourense</option>
                <option >Palencia</option>
                <option >Pontevedra</option>
                <option >S.C. Tenerife</option>
                <option >Salamanca</option>
                <option>Segovia</option>
                <option >Sevilla</option>
                <option >Soria</option>
                <option >Tarragona</option>
                <option>Teruel</option>
                <option >Toledo</option>
                <option >Valencia</option>
                <option >Valladolid</option>
                <option >Zamora</option>
                <option >Zaragoza</option> 
            </select>
            </paper-input-decorator>
            <br>
            <paper-input-decorator label="Status" floatingLabel error="Status is required!" id="esta">
            <select id="est"> 
                 <option value="0"> Select Status</option>    
                <option >Muy malo</option>
                <option>Malo</option>
                <option>Normal</option>
                <option>Bueno</option>
                <option >Muy bueno</option>
            </select>
            </paper-input-decorator><br>
            
       
            <paper-input-decorator label="Description" floatingLabel error="description is required!" id="desc">
                <textarea id="descripcion"rows="4" cols="50" required></textarea>
            </paper-input-decorator>  
         <!--   <span class="titulo">Añade algunas imágenes, ¡se venderá más rápido!</span><br><br>
                            
                <label for="img1">imagen #1</label>
                <input type="file" name="img1" id="img1" tabindex="12"/><br>
      
                <label for="img2">imagen #2</label>
                <input type="file" name="img2" id="img2" tabindex="13"/>-->
                                 
  
            

        
              
        </div>
          <div id="foo">
            <paper-button id="butt" on-tap="{{validates}}">Continue y publish</paper-button>
          </div>
        
        </section>     
      


        
    </template>
    <script>
        Polymer({
          
                ready:function(){
                    
                    
               
                   
                  
                },
           
                validateIsbn:function(e){
                  
                  
                  
                   var isbn=this.$.isbn;
                   
                
                   
                   if(isbn.validity.valid){
                     if(validator.isISBN(isbn.value)){
                        this.$.divisbn.hidden=!this.$.divisbn.hidden;
                      this.$.decoisbn.isInvalid=false;
         
                      this.$.tisbn.value="El ISBN "+isbn.value+" es correcto ";
                      this.$.ttitulo.value=" ";
                       this.$.tautor.value="";
                       this.$.timg.src="";
                     

                      var that=this;
                      var book="https://www.googleapis.com/books/v1/volumes?q=isbn:"+isbn.value;
                     
                      $.getJSON(book,function(result){
                       
                       var titulo=result.items[0].volumeInfo.title;
                       var autor=result.items[0].volumeInfo.authors;
                       var isbn=result.items[0].volumeInfo.industryIdentifiers[0].identifier;  
                       var imagen=result.items[0].volumeInfo.imageLinks.thumbnail;


                       // Set the table td text
                       that.$.tisbn.value="El ISBN   "+isbn+"  corresponde a:";
                       that.$.ttitulo.value="Titulo:   "+titulo;
                       that.$.tautor.value="Autor :    "+autor;
                       that.$.timg.src=imagen;
                     
                     });
                     }else{
                       this.$.decoisbn.isInvalid=true;
                       this.$.decoisbn.error="ISBN Invalid!";
                       this.$.divisbn.hidden=true;
                 
                     }
                  
                     
                    }else{
                      this.$.decoisbn.isInvalid=true;
                      this.$.decoisbn.error="ISBN is required!";
                      this.$.divisbn.hidden=true;
                    }
                },
                
                validates: function(){
                  if(this.valid()){
                 
                  var genre=this.$.cat.value;
                  var province=this.$.pro.value;
                   var isbn=this.$.isbn.value;
                  var author=this.$.autor.value;
                  var publisher=this.$.editorial.value;
                  var status=this.$.est.value;
                  var price=this.$.precio.value;
                  var title=this.$.titulo.value;
                  var description=this.$.descripcion.value;
                  
                  //------------apiss/////
               
                 $.post("/book",
                    {
                     genre : genre,
                    province : province,
                     isbn : isbn,
                    author : author,
                    publisher : publisher,
                    status : status,
                    price : price,
                    title : title,
                    description : description
                    },
                    function(data,status){
                      if (status){
                      alert("Book Save¡¡¡¡¡" + status);
                      location.reload();
                    }else{
                      alert("error¡¡¡¡");
                    }
                     
                    });
            
              }else{
                this.valid();
              }
                  
                },
                
                valid:function(){
                
                var inn=this.$.main.querySelectorAll('input');
                var flag=true;
                 
                for(var j=0;j<5;j++){             
               
                  if(inn[j].validity.valid==false){
                    flag=false;
                    
                    }
                }
                 
                var $d=this.$.main.querySelectorAll('paper-input-decorator');
           
                   for(var i=0;i<4;i++){
                      $d[i].isInvalid = !$d[i].querySelector('input').validity.valid;
                    
                    
                   }
                   var code=this.$.isbn.value;
                   
                   console.log(code);
                   if(this.$.isbn.validity.valid){
                                        if(validator.isISBN(code)){
                     console.log("isbn correcto");
                     this.$.decoisbn.isInvalid=false;
                   }else{
                     flag=false;
                     this.$.decoisbn.isInvalid=true;
                     this.$.decoisbn.error="ISBN Invalid!";
                     this.$.divisbn.hidden=true;
                   }
    
                   }else{
                     flag=false;
                     this.$.decoisbn.isInvalid=true;
                     this.$.decoisbn.error="ISBN required!";
                     this.$.divisbn.hidden=true;
                   }
                   

                
    
                      
                      
         
    
                   if(this.$.cat.value ==0){
                        this.$.cate.isInvalid=true;
                        flag=false;
                        
                      }else{
                        this.$.cate.isInvalid=false;
                       
                      }
                  if(this.$.pro.value ==0){
                        this.$.provi.isInvalid=true;
                        flag=false;
                      }else{
                        this.$.provi.isInvalid=false;
                       
                      
                    }
                  if(this.$.est.value ==0){
                        this.$.esta.isInvalid=true;
                        flag=false;
                      }else{
                        this.$.esta.isInvalid=false;
                     
                      }
                  if(this.$.descripcion.value ==""){
                    this.$.desc.isInvalid=true;
                    flag=false;
                  }else{
                    this.$.desc.isInvalid=false;
                    
                  }
                  var precio=this.$.precio;
                  
                  if(validator.isNumeric(precio.value)){
                  console.log("el precio es numerico      soy value precio");
                    this.$.decoprecio.isInvalid=false;
                }else{
                  console.log("el precio no es numerico");
                 this.$.decoprecio.isInvalid=true;
                     this.$.decoprecio.error="price Invalid!";
                     flag=false;
                }
                    return flag;
                   
                }
            
        });
    </script>
</polymer-element>
